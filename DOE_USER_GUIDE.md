# 🀄 LNP-Flow: Professional DOE Designer - 完整功能总结

## 📊 最新升级 - 3D 可视化与多设计支持

### ✨ 核心特性

#### 1️⃣ **7种DOE设计类型**
```
✓ Full Factorial (2-Level)     → 2^5 = 32 个实验
✓ Full Factorial (3-Level)     → 3^5 = 243 个实验  
✓ Fractional Factorial          → 2^(n-1) = 16 个实验
✓ Plackett-Burman              → 12 个实验（筛选设计）
✓ Box-Behnken                  → 26 个实验（响应曲面）
✓ Central Composite            → 30 个实验（完整响应曲面）
✓ Mixture Design               → 可变个实验（混合设计）
```

#### 2️⃣ **交互式3D可视化**

**Tab 1: 3D 摩尔比设计空间**
- X轴: 离子脂质 %
- Y轴: 胆固醇 %
- Z轴: PEG脂质 %
- 颜色: 辅助脂质 %
- 完全旋转、缩放和悬停信息

**Tab 2: 3D 工艺参数设计空间**
- X轴: 总流速 (mL/min)
- Y轴: 流速比 (水相:乙醇相)
- Z轴: 离子脂质 %
- 颜色: 胆固醇 %

**3D 体积分布分析**
- X轴: 离子脂质体积 (µL)
- Y轴: 辅助脂质体积 (µL)
- Z轴: PEG脂质体积 (µL)
- 颜色: 总流速
- 显示实际移液体积需求

#### 3️⃣ **响应曲面热力图**

**热力图1: 总体积 vs 离子脂质% vs 总流速**
- 显示体积如何在设计空间中变化
- 帮助理解体积约束

**热力图2: 辅助脂质体积 vs 胆固醇% vs 流速比**
- 显示辅助脂质体积变化
- 识别最优成分比例

#### 4️⃣ **自动体积计算**

```
摩尔% → 摩尔数 → 质量(mg) → 体积(µL)
  ↓
自动计算乙醇和缓冲液体积
  ↓
生成完整的移液计划
```

#### 5️⃣ **完整的运行表生成**

每个实验包括:
- 区块号 (实验组织)
- 运行ID (唯一标识)
- 实验号 (设计点)
- 重复号
- 摩尔百分比 (4个成分)
- 工艺参数 (TFR, FRR)
- 移液体积 (每个成分)
- 乙醇和缓冲液体积
- 总体积
- 时间戳
- 备注字段

#### 6️⃣ **双格式导出**

**CSV导出:**
- 通用格式
- 与所有实验室自动化系统兼容
- 直接导入LIMS

**Excel导出 (多个工作表):**
- 运行表: 完整的实验计划
- 设计矩阵: 因子水平
- 汇总: 元数据和参数

---

## 🎯 使用流程

### 第1步: 配置成分属性 (侧边栏)
- 设置分子量 (MW)
- 设置库存浓度
- 设置目标N/P比

### 第2步: 选择DOE设计 (设计选择标签)
- 选择合适的DOE方法
- 设置摩尔比范围
- 设置工艺参数范围
- 设置重复和区块数

### 第3步: 生成设计
- 点击 "🚀 Generate DOE Design" 按钮
- 系统验证参数范围
- 创建设计矩阵
- 计算移液体积
- 显示结果

### 第4步: 可视化结果
- 使用3D视图理解设计空间覆盖范围
- 检查响应曲面热力图以了解相互作用
- 查看3D体积分布

### 第5步: 导出结果
- 下载CSV用于实验室信息管理系统
- 下载Excel进行详细分析和文档记录
- 直接在实验室自动化中使用运行表

---

## 📐 数学基础

### N/P比率计算
```
N/P比 = 胺基摩尔数 / 磷酸基摩尔数
P ≈ DNA质量(µg) / 330 g/mol (dsDNA)
N = 来自离子脂质的胺基总数
```

### 摩尔比标准化
```
辅助脂质% = 100% - 离子脂质% - 胆固醇% - PEG脂质%

所有因子必须满足: 总和 = 100%
```

### 体积转换
```
1. 平均MW = Σ(成分% × 成分MW) / 100
2. 摩尔数 = (目标脂质质量) / (平均MW)
3. 成分摩尔数 = (成分%) × (总摩尔数) / 100
4. 成分体积(µL) = (成分质量 / 库存浓度) × 1000
```

---

## 🛠️ 组件数据库 (默认值)

| 成分 | 分子量 (g/mol) | 库存浓度 (mg/mL) |
|------|----------------|-----------------|
| 离子脂质 | 710.182 | 100.0 |
| 辅助脂质 (DSPC) | 790.147 | 12.5 |
| 胆固醇 | 386.654 | 20.0 |
| PEG脂质 (DMG-PEG2K) | 2509.2 | 50.0 |

---

## 💡 最佳实践

1. **筛选阶段**: 使用 Plackett-Burman 或 Fractional Factorial
2. **优化阶段**: 使用 Box-Behnken 或 Central Composite
3. **验证阶段**: 使用 2-3 个重复以获得统计显著性
4. **区块设计**: 如果在不同天数进行实验，使用多个区块
5. **体积约束**: 检查移液体积范围是否与您的设备兼容

---

## 📦 导出示例

### CSV运行表格式
```
Block,Run_ID,Experiment,Replicate,Ionizable_%,Helper_%,Cholesterol_%,PEG_%,TFR_mL_min,FRR,...
1,R001,1,1,45.00,51.00,35.00,1.00,8.00,2.00,...
1,R002,1,2,45.00,51.00,35.00,1.00,8.00,2.00,...
...
```

### Excel工作表
- **运行表**: 完整的移液指令
- **设计矩阵**: 因子设置
- **汇总**: 参数元数据

---

## 🔧 技术栈

- **框架**: Streamlit 1.52.1
- **可视化**: Plotly (2D和3D图表)
- **数据分析**: Pandas, NumPy
- **导出**: OpenPyXL (Excel)
- **Python版本**: 3.14

---

## 📊 应用架构

```
LNP-Flow
├── 侧边栏配置
│   ├── 脂质组件属性
│   └── 核酸参数
├── DOE配置 (标签式)
│   ├── Tab1: 设计选择
│   │   ├── DOE方法
│   │   ├── 摩尔比范围
│   │   ├── 工艺参数范围
│   │   └── 体积设置
│   └── Tab2: 高级选项
│       ├── 中心点设置
│       └── 设计信息
├── 生成按钮
├── 结果展示
│   ├── 汇总指标
│   ├── 设计矩阵表
│   ├── 运行表预览
│   ├── 3D可视化
│   │   ├── 3D摩尔空间
│   │   ├── 3D工艺空间
│   │   └── 3D体积分布
│   ├── 响应曲面热力图
│   ├── 导出选项 (CSV/Excel)
│   └── 统计信息
└── 帮助文档
```

---

## ✅ 已实现功能清单

✅ 7种DOE设计类型  
✅ 交互式3D散点图  
✅ 响应曲面热力图  
✅ 自动体积计算  
✅ CSV和Excel导出  
✅ 可自定义组件属性  
✅ 重复和区块设计  
✅ 实时参数验证  
✅ 完整的运行表生成  
✅ 统计摘要信息  

---

## 🚀 下一步建议

1. 在实验室测试运行表
2. 根据反馈调整参数范围
3. 创建自定义组件库
4. 集成LIMS系统
5. 添加结果分析模块

---

Generated: December 2025
Version: 2.0 Professional DOE Suite with 3D Visualization
Status: ✅ Production Ready
