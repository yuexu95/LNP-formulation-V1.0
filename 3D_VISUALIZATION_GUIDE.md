# 🎨 LNP-Flow: 3D 可视化功能详解

## 概述
High-Throughput Formulation 页面现在包含**多个交互式3D Plotly图表**，用于可视化LNP DOE设计空间。

---

## 📊 已实现的3D图表

### 1️⃣ **3D 摩尔比设计空间** 
**位置**: 可视化标签 - 第一个标签

**坐标系:**
```
X轴: 离子脂质百分比 (%)
Y轴: 胆固醇百分比 (%)
Z轴: PEG脂质百分比 (%)
颜色: 辅助脂质百分比 (%)
```

**特性:**
- 彩虹色标 (Viridis colorscale)
- 互动悬停信息显示所有4个摩尔比例
- 可旋转、缩放和平移
- 优化的相机角度 (俯视45°)
- 每个设计点显示为球形标记

**应用场景:**
- 理解摩尔比约束条件
- 可视化设计空间覆盖范围
- 识别因子间的相互作用

---

### 2️⃣ **3D 工艺参数设计空间**
**位置**: 可视化标签 - 第二个标签

**坐标系:**
```
X轴: 总流速 (mL/min)
Y轴: 流速比 (水相:乙醇相)
Z轴: 离子脂质百分比 (%)
颜色: 胆固醇百分比 (%)
```

**特性:**
- 等离子体色标 (Plasma colorscale)
- 互动悬停信息显示工艺参数和成分百分比
- 完全3D旋转功能
- 优化相机位置
- 标记线条白色边框便于区分

**应用场景:**
- 可视化工艺参数相互作用
- 优化混合条件
- 理解流速对配方的影响

---

### 3️⃣ **3D 体积分布分析** (新增)
**位置**: 结果展示 - 响应曲面之前

**坐标系:**
```
X轴: 离子脂质体积 (µL)
Y轴: 辅助脂质体积 (µL)
Z轴: PEG脂质体积 (µL)
颜色: 总流速 (mL/min)
```

**特性:**
- 土壤色标 (Turbo colorscale)
- 显示实际的移液体积需求
- 每个数据点代表一个实验运行
- 互动悬停显示：
  - 各组件体积
  - 总流速
  - 实验号
- 半透明标记便于查看重叠点

**应用场景:**
- 理解体积分布
- 检查移液器兼容性
- 识别极端体积情况

---

## 🎯 交互功能

### 所有3D图表的通用功能:

1. **旋转**: 鼠标左键拖动
2. **缩放**: 滚轮或双指捏合
3. **平移**: 鼠标右键拖动
4. **重置**: 双击背景
5. **悬停信息**: 鼠标悬停显示详细数据
6. **导出**: 右上角相机图标保存为PNG

### 彩色条功能:
- 显示颜色映射范围
- 移鼠标到特定值查看
- 完整的数值标度

---

## 📈 2D 热力图补充

### 热力图1: 总体积 vs 离子脂质% vs 总流速
**用途:**
- 显示如何改变摩尔比例和流速会影响总体积
- 识别最适的体积条件
- 快速定位高/低体积区域

**颜色标度:** RdYlBu_r (红-黄-蓝，反向)
- 红色: 高体积
- 黄色: 中等体积
- 蓝色: 低体积

### 热力图2: 辅助脂质体积 vs 胆固醇% vs 流速比
**用途:**
- 显示辅助脂质体积如何随因子变化
- 优化体积平衡
- 识别成分比例与流速的相互作用

**颜色标度:** Viridis (暗-绿-黄-亮)
- 紫色: 低体积
- 绿色: 中等体积
- 黄色: 高体积

---

## 🔧 技术实现

### Plotly Scatter3d 特性使用

```python
# 基本结构
fig = go.Figure(data=[go.Scatter3d(
    x=x_data,
    y=y_data,
    z=z_data,
    mode='markers',
    marker=dict(
        size=8,
        color=color_data,        # 按第4个维度着色
        colorscale='Viridis',    # 选择色标
        showscale=True,          # 显示颜色条
        line=dict(width=1, color='white'),  # 标记边框
        opacity=0.9              # 半透明度
    ),
    hoverinfo='text',           # 显示自定义悬停文本
    text=[...],                 # 自定义悬停信息
    name='Design Points'        # 图例名称
)])

# 布局设置
fig.update_layout(
    title="...",
    scene=dict(
        xaxis_title="...",
        yaxis_title="...",
        zaxis_title="...",
        camera=dict(
            eye=dict(x=1.5, y=1.5, z=1.3)  # 相机角度
        )
    ),
    height=600,                 # 图表高度
    hovermode='closest',        # 悬停模式
    showlegend=True
)
```

### 色标选择

**Viridis**: 
- 用途: 摩尔比分布
- 特点: 色盲友好、对比度高

**Plasma**:
- 用途: 工艺参数
- 特点: 动态、高可见性

**Turbo**:
- 用途: 体积分布
- 特点: 广泛的颜色范围、识别极端值

**RdYlBu_r**:
- 用途: 热力图
- 特点: 直观的温度映射

---

## 📱 响应式设计

所有3D图表都使用:
```
use_container_width=True  # 自适应容器宽度
height=600               # 合理的固定高度
```

确保在不同屏幕尺寸上正确显示。

---

## 🚀 使用流程

### 查看3D设计空间
1. 配置DOE参数
2. 点击 "Generate DOE Design"
3. 向下滚动到 "Design Space Visualization"
4. 在标签间切换查看不同视角

### 交互步骤
1. 用鼠标拖动旋转3D图表
2. 悬停查看具体数据
3. 使用缩放查看细节
4. 点击相机图标导出

---

## 💡 最佳实践

### 解读3D图表

**3D摩尔比空间:**
- 点的分布越均匀，设计覆盖越全面
- 颜色变化显示辅助脂质的范围
- 点的密集程度反映设计效率

**3D工艺参数空间:**
- 点的分布表明流速范围的覆盖
- 颜色梯度显示胆固醇比例的变化
- 可识别不可达的参数组合

**3D体积分布:**
- 点的分布显示实际需要的移液体积
- 极端点可能需要特殊的液体处理
- 群集表示常见的体积需求

---

## 🎨 自定义选项

### 可以调整的参数

```python
marker=dict(
    size=8,              # 标记大小 (1-20)
    colorscale='Viridis' # 其他选项: Plasma, Inferno, Magma, Cividis等
    opacity=0.9,         # 透明度 (0-1)
    line=dict(
        width=1,         # 边框宽度
        color='white'    # 边框颜色
    )
)

scene=dict(
    camera=dict(
        eye=dict(
            x=1.5,       # X相机位置
            y=1.5,       # Y相机位置
            z=1.3        # Z相机位置
        )
    )
)
```

---

## 📊 数据量支持

- **小型设计** (<50点): 完美显示，快速响应
- **中型设计** (50-200点): 流畅交互，清晰可见
- **大型设计** (200+点): 可能有点重叠，建议使用热力图

---

## 🔍 故障排除

### 问题: 3D图表不显示
**解决方案:** 
- 刷新页面
- 检查浏览器WebGL支持
- 尝试不同浏览器

### 问题: 性能缓慢
**解决方案:**
- 减少设计点数量
- 切换到2D视图
- 关闭其他标签页

### 问题: 颜色看不清
**解决方案:**
- 旋转改变视角
- 使用缩放放大
- 尝试不同的色标

---

## 🎓 学习资源

- [Plotly 3D Scatter 文档](https://plotly.com/python/3d-scatter-plots/)
- [Plotly 颜色标度](https://plotly.com/python/colorscales/)
- [WebGL 支持检查](https://www.khronos.org/webgl/)

---

Generated: December 2025
3D Visualization Module v1.0
Status: ✅ Production Ready
